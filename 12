import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# Функція завантаження даних
def load_data(file):
    try:
        df = pd.read_csv(file)
        return df
    except Exception as e:
        st.error(f"Помилка при завантаженні файлу: {e}")
        return None

# Функція очистки даних
def clean_data(df):
    df_clean = df.dropna()
    return df_clean

# Функція розрахунку статистики
def calculate_stats(df, cols):
    stats = {}
    for col in cols:
        stats[col] = {
            'mean': np.mean(df[col]),
            'median': np.median(df[col]),
            'min': np.min(df[col]),
            'max': np.max(df[col])
        }
    return stats

# Функція побудови графіків
def plot_graphs(df, cols):
    for col in cols:
        fig, ax = plt.subplots()
        sns.histplot(df[col], kde=True, ax=ax)
        ax.set_title(f"Гістограма {col}")
        st.pyplot(fig)

# Streamlit UI
st.title("Інтерактивний аналіз даних")

file = st.file_uploader("Завантажте CSV файл", type="csv")
if file:
    df = load_data(file)
    if df is not None:
        st.write("Попередній перегляд даних:")
        st.dataframe(df.head())

        selected_cols = st.multiselect("Обрати колонки для аналізу", df.columns)
        if selected_cols:
            df_clean = clean_data(df)
            stats = calculate_stats(df_clean, selected_cols)
            st.write("Статистика:")
            st.json(stats)

            st.write("Графіки:")
            plot_graphs(df_clean, selected_cols)

            if st.button("Зберегти результати"):
                pd.DataFrame(stats).to_csv("statistics.csv")
                st.success("Результати збережено у statistics.csv")
else:
    st.info("Будь ласка, завантажте CSV файл")
